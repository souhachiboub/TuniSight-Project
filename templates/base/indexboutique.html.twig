{% extends 'baseboutique.html.twig' %}

{% block listActivites %}
	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-center pb-4">
				<div class="col-md-12 heading-section text-center ftco-animate">
					<span class="subheading">Boutique </span>
					<h2 class="mb-4">Nos produits</h2>
				</div>
			</div>
			<div class="row">
                {% for produit in products %}
					<div class="col-md-4 ftco-animate">
						<div class="project-wrap">
							<a href="#" class="img" style="background-image: url('{{ asset('uploads/produits/' ~ produit.image) }}');">
								<span class="price"> {{ produit.prix }} TN</span>
							</a>
							<div class="text p-4">
							<div class="d-flex justify-content-between align-items-center w-100">
    <h3 class="m-0 flex-grow-1 text-start">{{ produit.libelle }}</h3>
    <span class="badge px-3 py-2 fs-5 text-white" 
          style="background-color: {% if produit.disponibilite %}#198754{% else %}#dc3545{% endif %}; 
                 min-width: 140px; text-align: center; font-size: 1rem;">
        {{ produit.disponibilite ? 'En stock' : 'Rupture de stock' }}
    </span>
</div>
				<div style="display: flex; gap: 10px;">
    <button class="btn-simple" onclick="addToCart({{ produit.id }}, '{{ produit.libelle }}', {{ produit.prix }})">
        Ajouter au panier
    </button>
    <button class="btn-simple btn-detail" onclick="window.location.href='{{ path('afficherproduit', {'id': produit.id}) }}'">
        Détail
    </button>
</div>

							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</section>





































































	<!-- Icône Chariot -->
	<div class="cart-container" onclick="toggleCart()">
		<i class="fas fa-shopping-cart"></i>
		<span id="cartCount" class="badge bg-primary">0</span>
	</div>
	<!-- Panier déroulant -->
	<div class="cart-dropdown" id="cartDropdown">
		<h4>Mon Panier</h4>
		<div id="cartItems"></div>
		<div id="cartTotal"></div>
		<button class="btn btn-primary" onclick="checkout()">Passer à la caisse</button>
		<button class="btn btn-danger" onclick="clearCart()">Vider le panier</button>
	</div>
{% endblock %}














{% block javascripts %}
<script>
	function toggleCart() {
		var cartDropdown = document.getElementById('cartDropdown');
		cartDropdown.style.display = (cartDropdown.style.display === 'block') ? 'none' : 'block';
	}
	function addToCart(id, libelle, prix) {
		var cart = JSON.parse(localStorage.getItem('cart')) || [];
		var productIndex = cart.findIndex(item => item.id === id);
		if (productIndex !== -1) {
			cart[productIndex].quantity++;
		} else {
			cart.push({ id: id, libelle: libelle, prix: prix, quantity: 1 });
		}
		localStorage.setItem('cart', JSON.stringify(cart));
		updateCart();
	}
	function increaseQuantity(id) {
		var cart = JSON.parse(localStorage.getItem('cart')) || [];
		var product = cart.find(item => item.id === id);
		if (product) {
			product.quantity++;
			localStorage.setItem('cart', JSON.stringify(cart));
			updateCart();
		}
	}
	function decreaseQuantity(id) {
		var cart = JSON.parse(localStorage.getItem('cart')) || [];
		var product = cart.find(item => item.id === id);
		if (product && product.quantity > 1) {
			product.quantity--;
			localStorage.setItem('cart', JSON.stringify(cart));
			updateCart();
		}
	}
	function updateCart() {
    var cartItemsContainer = document.getElementById('cartItems');
    var cartCount = document.getElementById('cartCount');
    var cartTotal = document.getElementById('cartTotal');
    var cart = JSON.parse(localStorage.getItem('cart')) || [];
    cartItemsContainer.innerHTML = '';
    cartTotal.innerHTML = '';
    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p>Aucun article dans le panier.</p>';
        cartCount.textContent = '0';
    } else {
        var totalQuantity = 0, totalPrice = 0;
        cart.forEach(item => {
            var cartItem = document.createElement('div');
            cartItem.innerHTML = `<p>${item.libelle} - ${item.quantity} x ${item.prix}€</p>
                <div class="quantity-btn">
                    <button class="tns-quantity-btn" onclick="decreaseQuantity(${item.id})">-</button>
                    <span>${item.quantity}</span>
                    <button class="tns-quantity-btn" onclick="increaseQuantity(${item.id})">+</button>
                </div>`;
            cartItemsContainer.appendChild(cartItem);
            totalQuantity += item.quantity;
            totalPrice += item.quantity * item.prix;
        });
        cartTotal.innerHTML = `<h5>Total: ${totalPrice}€</h5>`;
        cartCount.textContent = totalQuantity;
    }
}

	updateCart();

	function clearCart() {
		localStorage.removeItem('cart');
		updateCart();
	}

	function checkout() {
		alert('Passage à la caisse');
	}
</script>
{% endblock %}



{% block stylesheets1 %}

    <!-- Bootstrap CSS -->
    
    <!-- FontAwesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

{% endblock %}













































{% block css1 %}
<style>


















/* Smaller + and - buttons */
/* Smaller + and - buttons */
.tns-quantity-btn {
    width: 4px; /* Smaller width */
    height: 12px; /* Smaller height */
    font-size: 0.9rem; /* Smaller font size */
    color: #333;
    background-color: transparent;
    border: 1px solid #ddd;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.tns-quantity-btn:hover {
    background-color: #f0f0f0;
}









    /* Cart container */
    .cart-container {
        position: fixed;
        top: 20px;
        right: 20px;
    background-color: transparent; /* Remove background */
        padding: 10px;
        border-radius: 50%;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        z-index: 1000;
    }

    .cart-container i {
        font-size: 1.5rem;
    color: #53d2dc !important; /* Ensure color is applied with !important */
    }

    .cart-container .badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #53d2dc;
        color: white;
        font-size: 0.8rem;
        padding: 4px 8px;
        border-radius: 50%;
    }

    /* Cart dropdown */
    .cart-dropdown {
        position: fixed;
        top: 80px;
        right: 20px;
        background-color: #fff;
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 8px;
        width: 280px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: none;
        max-height: 400px;
        overflow-y: auto;
    }

    .cart-dropdown.active {
        display: block;
    }

    .cart-dropdown h4 {
        font-size: 1.25rem;
        margin-bottom: 10px;
        color: #333;
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
    }

    .cart-dropdown .cart-item {
        margin-bottom: 10px;
        font-size: 0.9rem;
        color: #555;
    }

    .cart-dropdown button {
        width: 100%;
        padding: 8px;
        margin-top: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 0.9rem;
        cursor: pointer;
        background-color: transparent;
        color: #333;
        transition: border-color 0.3s ease;
    }

    .cart-dropdown button:hover {
        border-color: #53d2dc;
    }

    
</style>
{% endblock %}