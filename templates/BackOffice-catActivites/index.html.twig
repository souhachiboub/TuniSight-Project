{% block title %}{% endblock %}
<!DOCTYPE html>
<html lang="en">

	<head>

		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">

		<title>Gestion des catégories</title>

		<link href="{{asset('admin/vendor/fontawesome-free/css/all.min.css')}}" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
		<link href="{{asset('admin/css/sb-admin-2.min.css')}}" rel="stylesheet">
		<link href="{{asset('admin/vendor/datatables/dataTables.bootstrap4.min.css')}}" rel="stylesheet">

	</head>

	<body
		id="page-top">

		<!-- Page Wrapper -->
		<div
			style="background-color:#26648e !important" id="wrapper">

			<!-- Sidebar -->
			<ul
				class="navbar-nav bg-dark sidebar sidebar-dark accordion" id="accordionSidebar">

				<!-- Sidebar - Brand -->
				<a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
					<div class="sidebar-brand-icon ">
						<img style="width:170px" src="{{asset('admin/img/logo.png')}}"/>
					</div>

				</a>


				<!-- Divider -->
				<hr
				class="sidebar-divider my-0">
				<!-- Divider -->
				<hr
				class="sidebar-divider">

				<!-- Nav Item - Dashboard -->
				<li class="nav-item">
					<a class="nav-link" href="{{asset('admin')}}">
						<i class="fas fa-fw fa-tachometer-alt"></i>
						<span>Dashboard</span>
					</a>
				</li>


				<!-- Divider -->
				<hr
				class="sidebar-divider">

				<!-- Nav Item - Charts -->
				<li class="nav-item">
					<a class="nav-link" href="{{asset('activite')}}">
						<i class="fas fa-fw fa-chart-area"></i>
						<span>Activités</span>
					</a>
				</li>

				<!-- Divider -->
				<hr class="sidebar-divider d-none d-md-block">

			</ul>
			<!-- End of Sidebar -->

			<!-- Content Wrapper -->
			<div
				id="content-wrapper" class="d-flex flex-column">

				<!-- Main Content -->
				<div
					id="content">

					<!-- Topbar -->
					<nav
						class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

						<!-- Sidebar Toggle (Topbar) -->
						<form class="form-inline">
							<button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
								<i class="fa fa-bars"></i>
							</button>
						</form>

						<!-- Topbar Search -->
						<form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
							<div class="input-group">
								<input type="text" class="form-control bg-light border-0 small" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
								<div class="input-group-append">
									<button class="btn btn-primary" type="button" style="background-color:#77b9d3">
										<i class="fas fa-search fa-sm"></i>
									</button>
								</div>
							</div>
						</form>

						<!-- Topbar Navbar -->
						<ul
							class="navbar-nav ml-auto">

							<!-- Nav Item - Search Dropdown (Visible Only XS) -->
							<li class="nav-item dropdown no-arrow d-sm-none">
								<a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<i class="fas fa-search fa-fw"></i>
								</a>
								<!-- Dropdown - Messages -->
								<div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in" aria-labelledby="searchDropdown">
									<form class="form-inline mr-auto w-100 navbar-search">
										<div class="input-group">
											<input type="text" class="form-control bg-light border-0 small" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
											<div class="input-group-append">
												<button class="btn btn-primary" type="button">
													<i class="fas fa-search fa-sm"></i>
												</button>
											</div>
										</div>
									</form>
								</div>
							</li>

							<!-- Nav Item - Alerts -->


							<div class="topbar-divider d-none d-sm-block"></div>

							<!-- Nav Item - User Information -->
							<li class="nav-item dropdown no-arrow">
								<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									<span class="mr-2 d-none d-lg-inline text-gray-600 small">Prestataire</span>
									<img class="img-profile rounded-circle" src="{{asset('admin/img/undraw_profile.svg')}}">
								</a>
								<!-- Dropdown - User Information -->
								<div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
									<a class="dropdown-item" href="#">
										<i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
										Profile
									</a>
									<a class="dropdown-item" href="#">
										<i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
										Settings
									</a>
									<a class="dropdown-item" href="#">
										<i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
										Activity Log
									</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
										<i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
										Logout
									</a>
								</div>
							</li>
						</ul>

					</nav>
					<!-- End of Topbar -->
					{% block body %}
						<h2 style="text-align:center">
							Gestion des catégories
						</h2>
						<br>
						<div class="d-flex justify-content-start">
							<button id="openModalBtn" data-url="{{ path('app_categorie_activite_new') }}" class="btn btn-primary">
								<span class="text">Ajouter une catégorie</span>
							</button>

						</div><br>


						<table class="table">
							<thead>
								<tr>
									<th>Id</th>
									<th>Nom</th>
									<th>Description</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for categorie_activite in categorie_activites %}
									<tr>
										<td>{{ categorie_activite.id }}</td>
										<td>{{ categorie_activite.nom }}</td>
										<td>{{ categorie_activite.description }}</td>
										<td>
											<a href="#" class="edit-btn" data-id="{{ categorie_activite.id }}">
												<img src="{{asset('admin/img/editIcone.png')}}"/>
											</a>

											<a href="{{ path('app_categorie_activite_show', {'id': categorie_activite.id}) }}"><img src="{{asset('admin/img/showIcone.png')}}"/></a>
											{{ include('BackOffice-catActivites/_delete_form.html.twig', { 
												'button_class': 'btn',
												'button_style': 'border: none; background: none; cursor: pointer;',
												'button_content': '<img src="' ~ asset('admin/img/deleteIcone.png') ~ '" alt="Delete"/>'
              								}) }}
										</td>
									</tr>
								{% else %}
									<tr>
										<td style="text-align:center" colspan="4">Pas de catégories</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					{% endblock %}

					<!-- Modal -->
					<div class="modal fade" id="addCategorieModal" tabindex="-1" role="dialog" aria-labelledby="addCategorieModalLabel" aria-hidden="false">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="addCategorieModalLabel">Ajouter une catégorie</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<div id="form-container"></div>
								</div>
							</div>
						</div>
					</div>
					<!--End Modal -->
					{% block javascripts %}
						<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
						<script>
							$(document).ready(function () {
$('#openModalBtn').on('click', function () {
let url = $(this).data('url');

$('#addCategorieModal').modal('show');
$('#addCategorieModalLabel').text('Ajouter une catégorie');
$('#form-container').html('');

$.ajax({
url: url,
method: 'GET',
success: function (response) {
$('#form-container').html(response.form);

$('#categorie-form').attr('action', url);

$('#categorie-form').on('submit', function (e) {
e.preventDefault();
let postUrl = $(this).attr('action');

$.ajax({
url: postUrl,
method: 'POST',
data: $(this).serialize(),
success: function (response) {
if (response.errors) {
$('#form-container').html(response.form);
} else {
$('#addCategorieModal').modal('hide');
location.reload();
}
},
error: function (xhr) {
alert('Erreur lors de l\'ajout');
console.log(xhr.responseText);
}
});
});
},
error: function (xhr) {
console.log(xhr.responseText);
}
});
});

$('#form-container').on('input', 'input, select, textarea', function () {
let dynamicUrl = calculateDynamicUrl();
$('#categorie-form').attr('action', dynamicUrl);
});

function calculateDynamicUrl() {
let dynamicUrl = $('#someInput').val() ? "/categorie/activite/modify" : "/categorie/activite/new";
return dynamicUrl;
}

});
$('.edit-btn').on('click', function () {
var id = $(this).data('id');
$('#addCategorieModal').modal('show');
$('#addCategorieModalLabel').text('Modifier la catégorie');
$('#form-container').html('');

$.ajax({
url: '{{ path("app_categorie_activite_edit", {"id": "replace_with_id"}) }}'.replace('replace_with_id', id),
method: 'GET',
success: function (response) {
$('#form-container').html(response);

$('#categorie-form').on('submit', function (e) {
e.preventDefault();
$.ajax({
url: '{{ path("app_categorie_activite_edit", {"id": "replace_with_id"}) }}'.replace('replace_with_id', id),
method: 'POST',
data: $(this).serialize(),
success: function () {
$('#addCategorieModal').modal('hide');
location.reload();
},
error: function (xhr) {
alert('Erreur lors de la modification');
console.log(xhr.responseText);
}
});
});
},
error: function (xhr) {
console.log(xhr.responseText);
}
});
});
						</script>
					{% endblock %}


					<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

					<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
